# `hermes run` コマンド

`hermes run` コマンドは、Hermesのコア機能であるリサーチタスクを実行するためのメインコマンドです。

## 機能

このコマンドは、指定されたプロンプトまたはタスクIDに基づいて、情報収集、分析、レポート生成までの一連のワークフローを起動します。

-   **プロンプト実行**: `--prompt` オプションで渡されたリサーチ内容を即座に実行します。
-   **タスク実行**: `--task-id` または `--task-all` を使い、`hermes task` で事前に登録したタスクを実行します。
-   **動的な設定上書き**: コマンドラインオプションを通じて、`config.yaml` の設定（使用するLLMモデル、検証回数など）を一時的に上書きできます。
-   **進捗表示**: `rich.progress` を利用して、実行中のタスクの進捗をスピナーで表示します。
-   **レポート出力**: 実行後、生成されたレポートが `history` ディレクトリに保存され、`--export` オプションで指定したパスにコピーすることも可能です。

## オプション

### コアオプション

| オプション | 説明 |
| :--- | :--- |
| `--prompt TEXT` | リサーチ内容をプロンプトとして直接指定し、即時実行します。 |
| `--task-id TEXT` | `hermes task` で登録したタスクのIDを指定して実行します。 |
| `--task-all` | 登録されているすべてのスケジュール済みタスクを実行します。 |
| `--export PATH` | 生成されたレポートを指定したパスにエクスポート（コピー）します。 |

### LLM関連オプション

| オプション | 説明 |
| :--- | :--- |
| `--api TEXT` | OllamaのAPIエンドポイントを上書きします。 |
| `--model TEXT` | 使用するLLMモデル名を上書きします。 |
| `--retry INT` | LLMへのAPIコールが失敗した際のリトライ回数を上書きします。 |

### 検証・検索オプション

| オプション | 説明 |
| :--- | :--- |
| `--min-validation INT` | レポートの品質を担保するための最小検証ループ回数を指定します。 |
| `--max-validation INT` | 最大検証ループ回数を指定します。 |
| `--min-search INT` | 収集する情報ソースの最小数を指定します。 |
| `--max-search INT` | 収集する情報ソースの最大数を指定します。 |
| `--query INT` | 生成する検索クエリの数を指定します。 |

### その他

| オプション | 説明 |
| :--- | :--- |
| `--language [ja\|en]` | レポートの出力言語を指定します。 |
| `--work-dir PATH` | ワークディレクトリのパスを指定します。デフォルトは `~/.hermes` です。 |

## 実装詳細

-   **CLIフレームワーク**: `click`
-   **サービス**:
    -   `hermes_cli.services.config_service.ConfigService`: 設定の読み込みとCLIオプションのマージを担当。
    -   `hermes_cli.services.run_service.RunService`: リサーチワークフローの実行を管理するコアサービス。
-   **メインロジック**:
    1.  `ConfigService` を使用して `config.yaml` から基本設定を読み込みます。
    2.  `ConfigService.merge_with_cli_args` を呼び出し、コマンドラインで渡されたオプションで設定を上書きします。
    3.  `hermes_cli.utils.logging.setup_logging` でロギングを設定します。
    4.  `RunService` を初期化し、`run_service.execute()` を非同期で実行します。
    5.  `execute` メソッド内で、`prompt`, `task_id`, `task_all` のいずれかに基づいて実行モードを決定します。
    6.  `LangGraph` で定義されたエージェントワークフロー (`hermes_cli.agents.graph`) を呼び出し、リサーチタスクを開始します。
    7.  処理が完了すると、結果（レポートのパスなど）を表示し、必要に応じて `--export` 先にファイルをコピーします。
    8.  例外が発生した場合は、エラーメッセージを表示して処理を中断します。
